<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="menu.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="contenido">
        <h:head>
            <title></title>

        </h:head>
        <f:metadata>
            <f:viewAction action="#{reportesControl.init()}" />   
        </f:metadata>       
        <h:body>
            <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"/>
            <f:event type="preRenderView" rendered="#{facesContext.postBack}" listener="#{accesoC.validaSesion('bm01reporte.xhtml')}"/>  
            <h:form>
                <div align="center">
                    <h:outputText value="Reporte BM-01" class="tituloPantalla" />
                </div>
                <p:separator/>
                <p:panelGrid style="width: 50%; margin: auto auto;" styleClass="sinBorde">
                    <p:row style="height: 80px">
                        <p:column style="width: 45%; text-align: right">
                            <p:outputLabel value="Generar en: " style="font-size: 15px"/>
                        </p:column>
                        <p:column>

                            <p:selectOneMenu id="slcfiltro" value="#{reportesControl.tipoReporte}"  style="width: 200px;">
                                <f:selectItem itemLabel="Seleccione...." itemValue="#{0}" />
                                <f:selectItem itemValue="1" itemLabel="EXCEL"/>
                                <f:selectItem itemValue="2" itemLabel="PDF"/>
                                <p:ajax event="change" update="pnlFiltros" listener="#{reportesControl.cargaInfoporTipoReporte()}"/>
                            </p:selectOneMenu>


                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2">
                            <h:panelGroup id="pnlFiltros" >
                                <p:panel  rendered="#{reportesControl.tipoReporte == 2}" style="border: none">
                                    <p:panelGrid style="margin: auto auto; width: 100%" styleClass="sinBorde">
                                        <p:row>
                                            <p:column style="width: 45%; text-align: right">
                                                <p:outputLabel value="Seleccione Fecha: " style="font-size: 15px"/>
                                            </p:column>
                                            <p:column>
                                                <p:calendar id="fechapdf" readonlyInput="true" showOn="button" locale="ed" pattern="dd/MM/yyyy" value="#{reportesControl.fecha}" />
                                            </p:column>
                                        </p:row>
                                        <p:row>
                                            <p:column style="width: 45%; text-align: right">
                                                <p:outputLabel value="Seleccione departamento: " style="font-size: 15px"/>
                                            </p:column>
                                            <p:column>
                                            <p:selectOneMenu id="depa" filter="true" filterMatchMode="contains" style="text-align: center; font-size: 1.4vw; font-weight: bolder; width: 80%;" 
                                             value="#{reportesControl.dep}" >
                                         <f:selectItems var="dep" value="#{reportesControl.departamentos}" itemLabel="#{dep.idDepartamento} #{dep.nomDepto}" itemValue="#{dep.idDepartamento}" />
                                               </p:selectOneMenu>
                                            </p:column>
                                        </p:row>
                                        <p:row style="height: 300px">
                                            <p:column colspan="2" style="text-align: center">
                                                <p:panelGrid style="width: 100%" styleClass="sinBorde">
                                                    <p:row>
                                                        <p:column>
                                                        </p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column colspan="2">
                                                            <h:panelGroup id="cmdDescargaDepto">
                                                                <p:commandLink id="cmdLinkDepto" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" actionListener="#{reportesControl.generar(2)}">
                                                                    <p:graphicImage value="resources/img/pdf.png" width="65px"/>
                                                                    <p:fileDownload value="#{reportesControl.file}" />
                                                                </p:commandLink>
                                                                <p:tooltip for="cmdLinkDepto" value="Descargar PDF" position="left"/>
                                                            </h:panelGroup>
                                                        </p:column>
                                                    </p:row>


                                                </p:panelGrid>

                                            </p:column>
                                        </p:row>

                                    </p:panelGrid>
                                </p:panel>
                                <p:panel rendered="#{reportesControl.tipoReporte == 1}" style="border: none">
                                    <p:panelGrid style="margin: auto auto; width: 100%" styleClass="sinBorde">
                                        <p:row>
                                            <p:column style="width: 45%; text-align: right">
                                                <p:outputLabel value="Seleccione Fecha: " style="font-size: 15px"/>
                                            </p:column>
                                            <p:column>
                                                <p:calendar id="fechaexcel" readonlyInput="true" showOn="button" locale="ed" pattern="dd/MM/yyyy" value="#{reportesControl.fecha}" />
                                            </p:column>
                                        </p:row>
                                        <p:row style="height: 300px">
                                            <p:column colspan="2">
                                                <p:panelGrid style="width: 100%" styleClass="sinBorde">
                                                    <p:row>
                                                        <p:column colspan="2" style="text-align: center">
                                                            
                                                        </p:column>
                                                    </p:row>
                                                    <p:row>
                                                        <p:column colspan="2" style="text-align: center">
                                                            <h:panelGroup id="cmdDescargaUR">
                                                                <p:commandLink id="cmdLinkUR" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" actionListener="#{reportesControl.generar(1)}">
                                                                    <p:graphicImage value="resources/img/excelIcon.png" width="60px"/>
                                                                    <p:fileDownload value="#{reportesControl.file}" />
                                                                </p:commandLink>
                                                                <p:tooltip for="cmdLinkUR" value="Descargar EXCEL" position="left"/>
                                                            </h:panelGroup>

                                                        </p:column> 
                                                    </p:row>
                                                </p:panelGrid>
                                            </p:column>

                                        </p:row>
                                    </p:panelGrid>
                                </p:panel>
                            </h:panelGroup>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </h:form>
            <p:dialog widgetVar="statusDialog" appendTo="@(body)" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                <p:graphicImage value="resources/img/imagenes/loading.gif" />
            </p:dialog>
        </h:body>
    </ui:define>
</ui:composition>

